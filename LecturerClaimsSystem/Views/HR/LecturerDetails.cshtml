@{
    ViewData["Title"] = "Lecturer Details";
    var lecturer = ViewBag.Lecturer as LecturerClaimsSystem.Models.User;
    var claims = ViewBag.Claims as List<LecturerClaimsSystem.Models.Claim>;
    var stats = ViewBag.Stats;
}

<div class="row">
    <div class="col-md-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>👤 Lecturer Profile: @lecturer.FullName</h2>
            <div>
                <a asp-action="EditLecturer" asp-route-id="@lecturer.UserId" class="btn btn-warning">
                    ✏️ Edit Profile
                </a>
                <a asp-action="DownloadLecturerReport" asp-route-id="@lecturer.UserId" class="btn btn-success">
                    ⬇️ Download Report
                </a>
            </div>
        </div>

        <!-- Lecturer Information Card -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5>📋 Personal Information</h5>
                    </div>
                    <div class="card-body">
                        <p><strong>Full Name:</strong> @lecturer.FullName</p>
                        <p><strong>Username:</strong> @lecturer.Username</p>
                        <p><strong>User ID:</strong> #@lecturer.UserId</p>
                        <p><strong>Role:</strong> <span class="badge bg-info">@lecturer.Role</span></p>
                        @if (stats.LastClaimDate != null)
                        {
                            <p><strong>Last Claim:</strong> @((DateTime)stats.LastClaimDate).ToString("dd MMM yyyy")</p>
                        }
                    </div>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="col-md-8">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card bg-primary text-white mb-3">
                            <div class="card-body text-center">
                                <h3>@stats.TotalClaims</h3>
                                <p>Total Claims Submitted</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-success text-white mb-3">
                            <div class="card-body text-center">
                                <h3>@stats.ApprovedClaims</h3>
                                <p>Approved Claims</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-warning text-white mb-3">
                            <div class="card-body text-center">
                                <h3>@stats.PendingClaims</h3>
                                <p>Pending Claims</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card bg-danger text-white mb-3">
                            <div class="card-body text-center">
                                <h3>@stats.RejectedClaims</h3>
                                <p>Rejected Claims</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Financial Summary -->
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5>💰 Financial Summary</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <h6>Total Earned (Approved Claims)</h6>
                        <h3 class="text-success">R@stats.TotalEarned.ToString("N2")</h3>
                    </div>
                    <div class="col-md-4">
                        <h6>Average Claim Amount</h6>
                        <h4>R@stats.AverageClaimAmount.ToString("N2")</h4>
                    </div>
                    <div class="col-md-4">
                        <h6>Approval Rate</h6>
                        <h4>@(stats.TotalClaims > 0 ? ((decimal)stats.ApprovedClaims / stats.TotalClaims * 100).ToString("N1") : "0")%</h4>
                    </div>
                </div>
            </div>
        </div>

        <!-- Claims History -->
        <div class="card">
            <div class="card-header bg-dark text-white">
                <h5>📄 Claims History</h5>
            </div>
            <div class="card-body">
                @if (claims.Any())
                {
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Claim ID</th>
                                    <th>Hours</th>
                                    <th>Rate</th>
                                    <th>Total Amount</th>
                                    <th>Status</th>
                                    <th>Submitted</th>
                                    <th>Reviewed By</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var claim in claims)
                                {
                                    <tr>
                                        <td><strong>#@claim.ClaimId</strong></td>
                                        <td>@claim.HoursWorked hrs</td>
                                        <td>R@claim.HourlyRate.ToString("N2")</td>
                                        <td><strong>R@claim.TotalAmount.ToString("N2")</strong></td>
                                        <td>
                                            <span class="badge bg-@(claim.Status == "Approved" ? "success" : claim.Status == "Rejected" ? "danger" : "warning")">
                                                @claim.Status
                                            </span>
                                        </td>
                                        <td>@claim.SubmittedDate.ToString("dd/MM/yyyy")</td>
                                        <td>@(claim.ReviewedBy ?? "N/A")</td>
                                        <td>
                                            <a asp-controller="Review" asp-action="ViewClaim" asp-route-id="@claim.ClaimId"
                                               class="btn btn-sm btn-info">
                                                View
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="alert alert-info">
                        <p class="mb-0">No claims submitted yet.</p>
                    </div>
                }
            </div>
        </div>

        <div class="mt-3">
            <a asp-action="LecturerManagement" class="btn btn-secondary">← Back to Lecturer Management</a>
        </div>
    </div>
</div>